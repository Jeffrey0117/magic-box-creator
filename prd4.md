# Phase 4 éœ€æ±‚æ–‡ä»¶ï¼šè³‡æ–™åŒ…åœ–ç‰‡å±•ç¤º + å‰µä½œè€…è³‡è¨Š

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

åœ¨è³‡æ–™åŒ…é é¢ (Box.tsx) æ–°å¢åœ–ç‰‡è¼ªæ’­å±•ç¤ºèˆ‡å‰µä½œè€…è³‡è¨Šå¡ç‰‡ï¼Œé¢¨æ ¼åƒè€ƒ 2010 å¹´ä»£ Instagram çš„æ¥µç°¡è¨­è¨ˆã€‚

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. å‰µä½œè€…è³‡è¨Šå¡ç‰‡
#### è¦–è¦ºè¨­è¨ˆ
- **å¤§é ­è²¼**: åœ“å½¢é ­åƒ (64x64px)
- **æš±ç¨±**: å‰µä½œè€…åç¨± (ä¾†è‡ª `user_profiles.display_name`)
- **å€‹äººç°¡ä»‹**: ä¸€è¡Œæ–‡å­—æè¿° (ä¾†è‡ª `user_profiles.bio`)
- **ä½ç½®**: é é¢æœ€ä¸Šæ–¹ï¼Œåœ¨è³‡æ–™åŒ…æ¨™é¡Œä¹‹å‰

#### è³‡æ–™ä¾†æº
```typescript
// å¾ user_profiles è³‡æ–™è¡¨è®€å–
{
  avatar_url: string;    // å¤§é ­è²¼ URL
  display_name: string;  // æš±ç¨±
  bio: string;          // å€‹äººç°¡ä»‹
}
```

---

### 2. è³‡æ–™åŒ…åœ–ç‰‡å±•ç¤º

#### åœ–ç‰‡æ•¸é‡è¦å‰‡
- **0 å¼µ**: ä¸é¡¯ç¤ºåœ–ç‰‡å€åŸŸ
- **1 å¼µ**: é¡¯ç¤ºå–®å¼µéœæ…‹åœ–ç‰‡
- **2-5 å¼µ**: é¡¯ç¤ºè¼ªæ’­åœ– (Carousel)

#### è¼ªæ’­åŠŸèƒ½ (ä½¿ç”¨ç¾æœ‰ Carousel çµ„ä»¶)
- å·¦å³ç®­é ­å°èˆª
- åœ–ç‰‡æŒ‡ç¤ºé» (Dots)
- æ”¯æ´éµç›¤æ“ä½œ (â† â†’)
- æ”¯æ´è§¸æ§æ»‘å‹• (Mobile)

#### åœ–ç‰‡å„²å­˜æ–¹å¼
- **é¸é … 1**: Supabase Storage (æ¨è–¦)
  - å‰µå»º `package-images` bucket
  - æª”æ¡ˆè·¯å¾‘: `{keyword_id}/{image_index}.jpg`
  - æœ€å¤§å–®æª” 5MB

- **é¸é … 2**: å¤–éƒ¨ URL
  - ç›´æ¥å„²å­˜åœ–ç‰‡ URL (imgur, cloudinary, etc.)
  - è¼ƒç°¡å–®ä½†ä¾è³´å¤–éƒ¨æœå‹™

---

## ğŸ¨ UI/UX è¨­è¨ˆ (Instagram 2010 é¢¨æ ¼)

### é…è‰²æ–¹æ¡ˆ
```css
èƒŒæ™¯: #fafafa (æ·ºç°)
å¡ç‰‡: #ffffff (ç´”ç™½)
é‚Šæ¡†: #dbdbdb (ä¸­ç°)
æ–‡å­—ä¸»è‰²: #262626 (æ·±é»‘)
æ–‡å­—æ¬¡è‰²: #8e8e8e (ç°è‰²)
æŒ‰éˆ•: #0095f6 (IG è—)
```

### ç‰ˆé¢é…ç½®
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âšª å‰µä½œè€…æš±ç¨±                    â”‚ â† å‰µä½œè€…è³‡è¨Šå¡ç‰‡
â”‚     å€‹äººç°¡ä»‹...                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚      [è¼ªæ’­åœ–ç‰‡å€åŸŸ]               â”‚ â† åœ–ç‰‡å±•ç¤º (å¦‚æœ‰)
â”‚                                 â”‚
â”‚     â€¢ â€¢ â€¢ â€¢ â€¢  (æŒ‡ç¤ºé»)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¦ è³‡æ–™åŒ…æ¨™é¡Œ                    â”‚ â† ç¾æœ‰å…§å®¹
â”‚  é—œéµå­—è§£é–å€...                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ è³‡æ–™åº«æ¶æ§‹

### Migration: `20251007000000_add_package_images.sql`

#### 1. æ–°å¢æ¬„ä½è‡³ `keywords` è³‡æ–™è¡¨
```sql
ALTER TABLE keywords
ADD COLUMN images TEXT[] DEFAULT ARRAY[]::TEXT[];

COMMENT ON COLUMN keywords.images IS 'è³‡æ–™åŒ…åœ–ç‰‡ URL é™£åˆ—ï¼Œæœ€å¤š 5 å¼µ';
```

#### 2. ç¢ºä¿ `user_profiles` æ¬„ä½å­˜åœ¨
```sql
-- å·²å­˜åœ¨æ–¼ 20251004000001_add_user_profiles.sql
-- avatar_url TEXT
-- display_name TEXT
-- bio TEXT
```

#### 3. å‰µå»º Supabase Storage Bucket (å¦‚ä½¿ç”¨ Storage)
```sql
INSERT INTO storage.buckets (id, name, public)
VALUES ('package-images', 'package-images', true);

-- RLS æ”¿ç­–
CREATE POLICY "Public read access"
ON storage.objects FOR SELECT
USING (bucket_id = 'package-images');

CREATE POLICY "Creator upload access"
ON storage.objects FOR INSERT
WITH CHECK (
  bucket_id = 'package-images'
  AND auth.uid()::text = (storage.foldername(name))[1]
);
```

---

## ğŸ“¦ çµ„ä»¶æ¶æ§‹

### 1. `CreatorCard.tsx` (æ–°å»º)
```typescript
interface CreatorCardProps {
  creatorId: string;
}

// åŠŸèƒ½:
// - æŸ¥è©¢ user_profiles è³‡æ–™
// - é¡¯ç¤ºå¤§é ­è²¼ã€æš±ç¨±ã€ç°¡ä»‹
// - Loading ç‹€æ…‹è™•ç†
```

### 2. `PackageImageCarousel.tsx` (æ–°å»º)
```typescript
interface PackageImageCarouselProps {
  images: string[]; // åœ–ç‰‡ URL é™£åˆ—
}

// åŠŸèƒ½:
// - 0 å¼µ: return null
// - 1 å¼µ: é¡¯ç¤ºå–®å¼µåœ–ç‰‡
// - 2+ å¼µ: ä½¿ç”¨ Carousel çµ„ä»¶
// - åœ–ç‰‡è¼‰å…¥å¤±æ•—è™•ç† (fallback)
```

### 3. ä¿®æ”¹ `Box.tsx`
```typescript
// æ–°å¢æŸ¥è©¢å‰µä½œè€…è³‡è¨Š
const fetchCreatorProfile = async (creatorId: string) => {
  const { data } = await supabase
    .from('user_profiles')
    .select('avatar_url, display_name, bio')
    .eq('id', creatorId)
    .single();
  return data;
};

// ç‰ˆé¢çµæ§‹
return (
  <>
    <CreatorCard creatorId={boxData.creator_id} />
    <PackageImageCarousel images={boxData.images} />
    {/* ç¾æœ‰çš„è§£é–è¡¨å–®... */}
  </>
);
```

---

## ğŸ¨ Creator ç®¡ç†é¢æ¿æ›´æ–°

### ä¿®æ”¹ `Creator.tsx`

#### æ–°å¢åœ–ç‰‡ä¸Šå‚³åŠŸèƒ½
```typescript
// ç‹€æ…‹ç®¡ç†
const [newImages, setNewImages] = useState<File[]>([]);
const [newImageUrls, setNewImageUrls] = useState<string[]>([]);

// åœ–ç‰‡ä¸Šå‚³è™•ç†
const handleImageUpload = async (files: FileList) => {
  // 1. æª¢æŸ¥æ•¸é‡ (æœ€å¤š 5 å¼µ)
  if (files.length > 5) {
    toast.error('æœ€å¤šä¸Šå‚³ 5 å¼µåœ–ç‰‡');
    return;
  }
  
  // 2. æª¢æŸ¥æª”æ¡ˆå¤§å° (æ¯å¼µ < 5MB)
  for (const file of files) {
    if (file.size > 5 * 1024 * 1024) {
      toast.error('åœ–ç‰‡å¤§å°ä¸èƒ½è¶…é 5MB');
      return;
    }
  }
  
  // 3. ä¸Šå‚³è‡³ Supabase Storage
  const urls = await uploadToStorage(files);
  setNewImageUrls(urls);
};
```

#### UI æ›´æ–°
```typescript
// åœ¨ã€Œæ–°å¢è³‡æ–™åŒ…ã€è¡¨å–®ä¸­åŠ å…¥:
<div>
  <label>è³‡æ–™åŒ…åœ–ç‰‡ (æœ€å¤š 5 å¼µ)</label>
  <input
    type="file"
    accept="image/*"
    multiple
    max={5}
    onChange={(e) => handleImageUpload(e.target.files)}
  />
  {/* åœ–ç‰‡é è¦½ */}
  <div className="grid grid-cols-3 gap-2">
    {newImageUrls.map((url, i) => (
      <img key={i} src={url} alt={`é è¦½ ${i+1}`} />
    ))}
  </div>
</div>
```

---

## ğŸ” å®‰å…¨æ€§è€ƒé‡

### åœ–ç‰‡ä¸Šå‚³é™åˆ¶
- âœ… æª”æ¡ˆé¡å‹: `image/jpeg, image/png, image/webp`
- âœ… æª”æ¡ˆå¤§å°: å–®æª” < 5MB
- âœ… åœ–ç‰‡æ•¸é‡: æœ€å¤š 5 å¼µ
- âœ… RLS æ”¿ç­–: åªæœ‰å‰µä½œè€…å¯ä¸Šå‚³è‡³è‡ªå·±çš„è³‡æ–™å¤¾

### å„²å­˜è·¯å¾‘è¦ç¯„
```
package-images/
â”œâ”€â”€ {creator_id}/
â”‚   â”œâ”€â”€ {keyword_id}_1.jpg
â”‚   â”œâ”€â”€ {keyword_id}_2.jpg
â”‚   â””â”€â”€ ...
```

---

## ğŸš€ å¯¦ä½œæ­¥é©Ÿå»ºè­°

### Step 1: è³‡æ–™åº«æº–å‚™
1. åŸ·è¡Œ Migration æ–°å¢ `images` æ¬„ä½
2. å‰µå»º Storage Bucket (å¦‚ä½¿ç”¨ Storage)
3. è¨­å®š RLS æ”¿ç­–

### Step 2: å‰µä½œè€…è³‡è¨Šçµ„ä»¶
1. å»ºç«‹ `CreatorCard.tsx`
2. æ•´åˆè‡³ `Box.tsx`
3. æ¸¬è©¦é¡¯ç¤ºæ•ˆæœ

### Step 3: åœ–ç‰‡è¼ªæ’­çµ„ä»¶
1. å»ºç«‹ `PackageImageCarousel.tsx`
2. æ•´åˆç¾æœ‰ Carousel çµ„ä»¶
3. æ¸¬è©¦ 0/1/å¤šå¼µåœ–ç‰‡æƒ…å¢ƒ

### Step 4: Creator ç®¡ç†é¢æ¿
1. æ–°å¢åœ–ç‰‡ä¸Šå‚³ UI
2. å¯¦ä½œä¸Šå‚³é‚è¼¯
3. æ–°å¢åœ–ç‰‡é è¦½åŠŸèƒ½
4. æ¸¬è©¦ç·¨è¼¯æ¨¡å¼

### Step 5: æ¨£å¼èª¿æ•´
1. å¥—ç”¨ Instagram 2010 é¢¨æ ¼
2. RWD éŸ¿æ‡‰å¼èª¿æ•´
3. Loading èˆ‡éŒ¯èª¤ç‹€æ…‹è™•ç†

---

## ğŸ“Š è³‡æ–™æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Creator é é¢â”‚
â”‚ (ä¸Šå‚³åœ–ç‰‡)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Upload
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Storage â”‚
â”‚ /package-images/ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ å„²å­˜ URL
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ keywords è¡¨  â”‚
â”‚ images: []   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ æŸ¥è©¢
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Box é é¢    â”‚
â”‚ (é¡¯ç¤ºè¼ªæ’­)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ é©—æ”¶æ¸…å–®

- [ ] Migration åŸ·è¡ŒæˆåŠŸ
- [ ] Storage Bucket å»ºç«‹å®Œæˆ
- [ ] CreatorCard çµ„ä»¶é¡¯ç¤ºæ­£å¸¸
- [ ] åœ–ç‰‡è¼ªæ’­åŠŸèƒ½æ­£å¸¸ (0/1/å¤šå¼µ)
- [ ] Creator å¯ä¸Šå‚³åœ–ç‰‡ (æœ€å¤š 5 å¼µ)
- [ ] åœ–ç‰‡é è¦½åŠŸèƒ½æ­£å¸¸
- [ ] ç·¨è¼¯æ¨¡å¼å¯ä¿®æ”¹åœ–ç‰‡
- [ ] RWD éŸ¿æ‡‰å¼æ­£å¸¸
- [ ] Instagram é¢¨æ ¼æ¨£å¼å®Œæˆ

---

## ğŸ¨ åƒè€ƒè¨­è¨ˆ (Instagram 2010 é¢¨æ ¼é‡é»)

### å‰µä½œè€…å¡ç‰‡
- åœ“å½¢å¤§é ­è²¼ + æ¥µç°¡è³‡è¨Š
- ç™½è‰²èƒŒæ™¯ + æ·ºç°é‚Šæ¡†
- æš±ç¨±ç²—é«”ã€ç°¡ä»‹ç´°é«”

### åœ–ç‰‡å±•ç¤º
- æ­£æ–¹å½¢è£åˆ‡ (1:1 æ¯”ä¾‹)
- ä¹¾æ·¨çš„è¼ªæ’­æŒ‡ç¤ºé»
- ç„¡è¤‡é›œç‰¹æ•ˆï¼Œå¼·èª¿å…§å®¹

### æ•´é«”é¢¨æ ¼
- ç•™ç™½å……è¶³
- é‚Šæ¡†ç´°ç·» (1px)
- å­—é«”: system-ui / -apple-system
- é…è‰²å–®ç´” (é»‘ç™½ç° + IG è—)

---

**ğŸ“ å‚™è¨»**: æ­¤è¨­è¨ˆå¼·èª¿ç°¡ç´„èˆ‡æ˜“ç”¨æ€§ï¼Œåœ–ç‰‡å±•ç¤ºä¸æ¶æˆ²ï¼Œè®“å…§å®¹æœ¬èº«æˆç‚ºç„¦é»ã€‚